(self.webpackChunkclient=self.webpackChunkclient||[]).push([[974],{927:(e,t,n)=>{"use strict";n.r(t);var o=n(7294),r=n(3935),a=n(3727),c=n(5977),l=n(7703),i=n(7661),s=n.n(i),u=n(5019),d=n.n(u),p=n(8382),m=n.n(p);function _(){return o.createElement(l.Provider,{store:s()},o.createElement(a.BrowserRouter,{basename:"/vvlt"},o.createElement("div",null,o.createElement("ul",null,o.createElement("li",null,o.createElement(a.Link,{to:"/"},"Home")),o.createElement("li",null,o.createElement(a.Link,{to:"/about"},"About"))),o.createElement("hr",null),o.createElement(c.rs,null,o.createElement(c.AW,{exact:!0,path:"/"},o.createElement(d(),null)),o.createElement(c.AW,{path:"/about"},o.createElement(f,null)),o.createElement(c.AW,{path:"/game"},o.createElement(m(),null))))))}function f(){return o.createElement("div",null,"Whatch'you wanna know about?")}var h=n(2933);const C=document.createElement("div");var E;document.body.appendChild(C),E=C,r.render(o.createElement(_,null),E),s().dispatch((0,h.wsConnect)({host:"wss://salty-mesa-40253.herokuapp.com/connect"}))},4720:(e,t,n)=>{"use strict";n.r(t),n.d(t,{p2pConnect:()=>p,p2pConnecting:()=>m,p2pConnected:()=>_,p2pDisconnect:()=>f,p2pMessage:()=>h,p2pSend:()=>C,p2pSignal:()=>E,newCanvas:()=>v,default:()=>S});var o=n(7407),r=n(8853),a=n.n(r),c=n(2933),l=n(89),i=n(8909),s=n(3628);const u=new Image;u.src=i;const d=new Image;d.src=s;const p=(0,o.createAction)("P2P_CONNECT",(function(e){return{payload:e}})),m=(0,o.createAction)("P2P_CONNECTING"),_=(0,o.createAction)("P2P_CONNECTED"),f=(0,o.createAction)("P2P_DISCONNECT"),h=(0,o.createAction)("P2P_MESSAGE"),C=(0,o.createAction)("P2P_NEW_MESSAGE",(function(e){return{payload:e}})),E=(0,o.createAction)("P2P_SIGNAL",(function(e){return e})),v=(0,o.createAction)("NEW_GAME_CANVAS",(function(e){return{payload:e}})),S=(()=>{let e=null,t=null,n=null,o=null,r=null,i=0;return s=>p=>m=>{switch(m.type){case"P2P_CONNECT":return null!==e&&e.destroy(),e=new(a())({initiator:m.payload}),n=m.payload,e.on("signal",(e=>t=>{e.dispatch((0,c.wsSend)({Signal:{payload:JSON.stringify(t)}}))})(s)),e.on("connect",(e=>()=>{console.log("p2p","onConnect"),e.dispatch(_())})(s)),e.on("error",(e=>t=>{console.log("p2p","onError"),e.dispatch(f()),e.dispatch((0,c.wsSend)("LeaveRoom"))})(s)),e.on("data",(n=>{let o=t.handle_remote_input(n,performance.now());o&&e.send(o)})),p(m);case"P2P_DISCONNECT":return null!==e&&e.destroy(),e=null,p(m);case"P2P_NEW_MESSAGE":e.send(m.payload);break;case"P2P_SIGNAL":e.signal(JSON.parse(m.payload));break;case"NEW_GAME_CANVAS":let h=m.payload;if(null===h){cancelAnimationFrame(o),clearInterval(r);break}const C=new l.cQI(h,u,d),E=new l.Thl(C);E.set_width_height(512,512),t=new l.jaY(n),document.addEventListener("keydown",(n=>{let o=null;switch(n.key){case"ArrowUp":o=t.handle_up_pressed();break;case"ArrowDown":o=t.handle_down_pressed();break;case"ArrowLeft":o=t.handle_left_pressed();break;case"ArrowRight":o=t.handle_right_pressed();break;case" ":o=t.handle_fire_pressed()}o&&(n.preventDefault(),e.send(o))})),document.addEventListener("keyup",(n=>{let o=null;switch(n.key){case"ArrowUp":o=t.handle_up_released();break;case"ArrowDown":o=t.handle_down_released();break;case"ArrowLeft":o=t.handle_left_released();break;case"ArrowRight":o=t.handle_right_released();break;case" ":o=t.handle_fire_released()}o&&(n.preventDefault(),e.send(o))}));const v=e=>{E.render(t),o=requestAnimationFrame(v)};o=requestAnimationFrame(v);const S=16;r=setInterval((()=>{const n=t.needs_hash();n&&e.send(n);const o=t.needs_ping(performance.now());o&&e.send(o),t.estimated_remote_frame()+2*Math.max(t.latency_ms(),10*S)/S>=i&&(i=t.step())}),S);break;default:return p(m)}}})()},2933:(e,t,n)=>{"use strict";n.r(t),n.d(t,{wsConnect:()=>c,wsConnecting:()=>l,wsConnected:()=>i,wsDisconnect:()=>s,wsMessage:()=>u,wsSend:()=>d,default:()=>p});var o=n(7407),r=n(7661),a=n(4720);const c=(0,o.createAction)("WS_CONNECT"),l=(0,o.createAction)("WS_CONNECTING"),i=(0,o.createAction)("WS_CONNECTED"),s=(0,o.createAction)("WS_DISCONNECT"),u=(0,o.createAction)("WS_MESSAGE"),d=(0,o.createAction)("WS_NEW_MESSAGE",(function(e){return{payload:e}})),p=(()=>{let e=null;return t=>n=>o=>{switch(o.type){case"WS_CONNECT":null!==e&&e.close(),e=new WebSocket(o.payload.host),e.onmessage=(e=>t=>{const n=JSON.parse(t.data);"function"==typeof r[n.type]?e.dispatch(r[n.type](n.content)):"Signal"==n.type?e.dispatch((0,a.p2pSignal)(n.content)):console.error("unrecognized response!")})(t),e.onclose=(e=>()=>{e.dispatch(s())})(t),e.onopen=(e=>t=>{e.dispatch(i(t.target.url))})(t);break;case"WS_DISCONNECT":null!==e&&e.close(),e=null;break;case"WS_NEW_MESSAGE":e.send(JSON.stringify(o.payload));break;default:return n(o)}}})()},7661:function(e,t,n){"use strict";var o,r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return c(t,e),t},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],c=0,l=a.length;c<l;c++,r++)o[r]=a[c];return o},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.SetID=t.JoinedRoom=t.RemovedRoom=t.CreatedRoom=t.AllRooms=t.ConnectionState=void 0;var u,d=n(7407),p=s(n(2933)),m=l(n(4720));!function(e){e[e.NotConnected=0]="NotConnected",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(u=t.ConnectionState||(t.ConnectionState={}));var _={user_id:null,rooms:[],active_room:null,p2p_connection_state:u.NotConnected},f=d.createSlice({name:"root",initialState:_,reducers:{AllRooms:function(e,t){return Object.assign({},e,{rooms:t.payload.rooms})},CreatedRoom:function(e,t){return r(r({},e),{rooms:e.rooms.concat(t.payload.room)})},RemovedRoom:function(e,t){return r(r({},e),{rooms:e.rooms.filter((function(e){return e.id!==t.payload.room_id})),active_room:e.active_room==t.payload.room_id?null:e.active_room})},JoinedRoom:function(e,t){return r(r({},e),{active_room:t.payload.room_id})},SetID:function(e,t){return r(r({},e),{user_id:t.payload.user_id})}},extraReducers:function(e){e.addCase(m.p2pConnected,(function(e,t){return r(r({},e),{p2p_connection_state:u.Connected})})),e.addCase(m.p2pConnect,(function(e,t){return r(r({},e),{p2p_connection_state:u.Connecting})})),e.addCase(m.p2pDisconnect,(function(e,t){return r(r({},e),{p2p_connection_state:u.NotConnected})}))}}),h=i([p.default,m.default],d.getDefaultMiddleware());t.AllRooms=(o=f.actions).AllRooms,t.CreatedRoom=o.CreatedRoom,t.RemovedRoom=o.RemovedRoom,t.JoinedRoom=o.JoinedRoom,t.SetID=o.SetID,t.default=d.configureStore({reducer:f.reducer,middleware:h})},8382:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var a=r(n(7294)),c=n(7703),l=n(4720),i=n(7661);t.default=c.connect((function(e,t){return o(o({},t),{user_id:e.user_id,connection_state:e.p2p_connection_state})}),null)((function(e){var t=e.room,n=(e.user_id,e.connection_state),o=c.useDispatch();switch(n){case i.ConnectionState.NotConnected:case i.ConnectionState.Connecting:return a.default.createElement("div",null,"Loading: ",t.name);case i.ConnectionState.Connected:return a.default.createElement("div",null,t.name,a.default.createElement("canvas",{width:512,height:512,ref:function(e){o(l.newCanvas(e))}}))}}))},5019:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var r=o(n(7294)),a=n(7703),c=n(6396),l=n(3727),i=o(n(8382)),s=o(n(7661)),u=n(2933),d=n(4720),p=o(n(3912)),m=o(n(1548)),_=o(n(5125)),f=o(n(7463)),h=c.makeStyles((function(e){return{root:{}}}));t.default=a.connect((function(e){return{rooms:e.rooms,active_room:e.active_room}}),{})((function(e){var t=e.rooms,n=e.active_room,o=h(),c=(l.useHistory(),a.useDispatch()),C=function(e){s.default.dispatch(u.wsSend({JoinRoom:{room_id:e}})),c(d.p2pConnect(!1))};if(n){var E=t.find((function(e){return e.id==n}));return r.default.createElement(i.default,{room:E})}return r.default.createElement("div",{className:o.root},r.default.createElement(p.default,{variant:"contained",color:"primary",onClick:function(){c(u.wsSend({CreateRoom:{name:"Test Room "+Math.random()}})),c(d.p2pConnect(!0))}},"Create Room"),r.default.createElement(m.default,{component:"nav"},t.map((function(e,t){return r.default.createElement(_.default,{key:e.id,button:!0,onClick:C.bind(null,e.id)},r.default.createElement(f.default,{primary:e.name}))}))))}))},3628:(e,t,n)=>{"use strict";e.exports=n.p+"1fc2c97db2bdbddca248.png"},8909:(e,t,n)=>{"use strict";e.exports=n.p+"afbb487d80b277a0cf24.png"},1758:()=>{}}]);
//# sourceMappingURL=974.a2a6761d9230d8d2d042.bundle.js.map
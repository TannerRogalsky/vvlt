(self.webpackChunkclient=self.webpackChunkclient||[]).push([[974],{927:(e,t,n)=>{"use strict";n.r(t);var o=n(7294),a=n(3935),r=n(3727),c=n(5977),l=n(7703),i=n(7661),s=n.n(i),u=n(5019),d=n.n(u),f=n(8382),p=n.n(f);function m(){return o.createElement(l.Provider,{store:s()},o.createElement(r.BrowserRouter,{basename:"/vvlt"},o.createElement("div",null,o.createElement("ul",null,o.createElement("li",null,o.createElement(r.Link,{to:"/"},"Home")),o.createElement("li",null,o.createElement(r.Link,{to:"/about"},"About"))),o.createElement("hr",null),o.createElement(c.rs,null,o.createElement(c.AW,{exact:!0,path:"/"},o.createElement(d(),null)),o.createElement(c.AW,{path:"/about"},o.createElement(_,null)),o.createElement(c.AW,{path:"/game"},o.createElement(p(),null))))))}function _(){return o.createElement("div",null,"Whatch'you wanna know about?")}var h=n(2933);const C=document.createElement("div");var E;document.body.appendChild(C),E=C,a.render(o.createElement(m,null),E),s().dispatch((0,h.wsConnect)({host:"wss://salty-mesa-40253.herokuapp.com/connect"}))},4720:(e,t,n)=>{"use strict";n.r(t),n.d(t,{p2pConnect:()=>f,p2pConnecting:()=>p,p2pConnected:()=>m,p2pDisconnect:()=>_,p2pMessage:()=>h,p2pSend:()=>C,p2pSignal:()=>E,newCanvas:()=>v,newDebugCanvas:()=>y,default:()=>S});var o=n(7407),a=n(8853),r=n.n(a),c=n(2933),l=n(89),i=n(8909),s=n(3628);const u=new Image;u.src=i;const d=new Image;d.src=s;const f=(0,o.createAction)("P2P_CONNECT",(function(e){return{payload:e}})),p=(0,o.createAction)("P2P_CONNECTING"),m=(0,o.createAction)("P2P_CONNECTED"),_=(0,o.createAction)("P2P_DISCONNECT"),h=(0,o.createAction)("P2P_MESSAGE"),C=(0,o.createAction)("P2P_NEW_MESSAGE",(function(e){return{payload:e}})),E=(0,o.createAction)("P2P_SIGNAL",(function(e){return e})),v=(0,o.createAction)("NEW_GAME_CANVAS",(function(e){return{payload:e}})),y=(0,o.createAction)("NEW_DEBUG_CANVAS",(function(e){return{payload:e}})),S=(()=>{let e=null,t=null,n=null,o=null,a=null,i=null,s=0,f=0,p=null;return h=>C=>E=>{switch(E.type){case"P2P_CONNECT":return null!==e&&e.destroy(),e=new(r())({initiator:E.payload}),n=E.payload,e.on("signal",(e=>t=>{e.dispatch((0,c.wsSend)({Signal:{payload:JSON.stringify(t)}}))})(h)),e.on("connect",(e=>()=>{console.log("p2p","onConnect"),e.dispatch(m())})(h)),e.on("error",(e=>t=>{console.log("p2p","onError"),e.dispatch(_()),e.dispatch((0,c.wsSend)("LeaveRoom"))})(h)),e.on("data",(n=>{let o=t.handle_remote_input(n,performance.now());o&&e.send(o)})),C(E);case"P2P_DISCONNECT":return null!==e&&e.destroy(),e=null,C(E);case"P2P_NEW_MESSAGE":e.send(E.payload);break;case"P2P_SIGNAL":e.signal(JSON.parse(E.payload));break;case"NEW_DEBUG_CANVAS":const v=E.payload;if(null===v){cancelAnimationFrame(p);break}const y=v.getContext("2d"),S=3,b=16,g=e=>{let n=0;y.clearRect(0,0,v.width,v.height),y.font=`${b}px serif`,y.fillText(`Latency (ms): ${t.latency_ms()}`,S,n+=b),y.fillText(`Local Frame: ${s}`,S,n+=b),y.fillText(`Remote Frame: ${t.estimated_remote_frame()}`,S,n+=b),y.fillText(`Synced Frame: ${t.last_synchronized()}`,S,n+=b),y.fillText(`Hashes Sent: ${f}`,S,n+=b),p=requestAnimationFrame(g)};p=requestAnimationFrame(g);break;case"NEW_GAME_CANVAS":if(o)break;if(o=E.payload,null===o){cancelAnimationFrame(a),clearInterval(i);break}const w=new l.cQI(o,u,d),A=new l.Thl(w);A.set_width_height(512,512),t=new l.jaY(n,0),document.addEventListener("keydown",(n=>{let o=null;switch(n.key){case"ArrowUp":o=t.handle_up_pressed();break;case"ArrowDown":o=t.handle_down_pressed();break;case"ArrowLeft":o=t.handle_left_pressed();break;case"ArrowRight":o=t.handle_right_pressed();break;case" ":o=t.handle_fire_pressed()}o&&(n.preventDefault(),e.send(o))})),document.addEventListener("keyup",(n=>{let o=null;switch(n.key){case"ArrowUp":o=t.handle_up_released();break;case"ArrowDown":o=t.handle_down_released();break;case"ArrowLeft":o=t.handle_left_released();break;case"ArrowRight":o=t.handle_right_released();break;case" ":o=t.handle_fire_released()}o&&(n.preventDefault(),e.send(o))}));const N=e=>{A.render(t),a=requestAnimationFrame(N)};a=requestAnimationFrame(N);const k=16;i=setInterval((()=>{const n=t.needs_hash();n&&(f+=1,e.send(n));const o=t.needs_ping(performance.now());o&&e.send(o),t.estimated_remote_frame()+2*Math.max(t.latency_ms(),10*k)/k>=s&&(s=t.step())}),k);break;default:return C(E)}}})()},2933:(e,t,n)=>{"use strict";n.r(t),n.d(t,{wsConnect:()=>c,wsConnecting:()=>l,wsConnected:()=>i,wsDisconnect:()=>s,wsMessage:()=>u,wsSend:()=>d,default:()=>f});var o=n(7407),a=n(7661),r=n(4720);const c=(0,o.createAction)("WS_CONNECT"),l=(0,o.createAction)("WS_CONNECTING"),i=(0,o.createAction)("WS_CONNECTED"),s=(0,o.createAction)("WS_DISCONNECT"),u=(0,o.createAction)("WS_MESSAGE"),d=(0,o.createAction)("WS_NEW_MESSAGE",(function(e){return{payload:e}})),f=(()=>{let e=null;return t=>n=>o=>{switch(o.type){case"WS_CONNECT":null!==e&&e.close(),e=new WebSocket(o.payload.host),e.onmessage=(e=>t=>{const n=JSON.parse(t.data);"function"==typeof a[n.type]?e.dispatch(a[n.type](n.content)):"Signal"==n.type?e.dispatch((0,r.p2pSignal)(n.content)):console.error("unrecognized response!")})(t),e.onclose=(e=>()=>{e.dispatch(s())})(t),e.onopen=(e=>t=>{e.dispatch(i(t.target.url))})(t);break;case"WS_DISCONNECT":null!==e&&e.close(),e=null;break;case"WS_NEW_MESSAGE":e.send(JSON.stringify(o.payload));break;default:return n(o)}}})()},7661:function(e,t,n){"use strict";var o,a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return c(t,e),t},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],c=0,l=r.length;c<l;c++,a++)o[a]=r[c];return o},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.SetID=t.JoinedRoom=t.RemovedRoom=t.CreatedRoom=t.AllRooms=t.ConnectionState=void 0;var u,d=n(7407),f=s(n(2933)),p=l(n(4720));!function(e){e[e.NotConnected=0]="NotConnected",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(u=t.ConnectionState||(t.ConnectionState={}));var m={user_id:null,rooms:[],active_room:null,p2p_connection_state:u.NotConnected},_=d.createSlice({name:"root",initialState:m,reducers:{AllRooms:function(e,t){return Object.assign({},e,{rooms:t.payload.rooms})},CreatedRoom:function(e,t){return a(a({},e),{rooms:e.rooms.concat(t.payload.room)})},RemovedRoom:function(e,t){return a(a({},e),{rooms:e.rooms.filter((function(e){return e.id!==t.payload.room_id})),active_room:e.active_room==t.payload.room_id?null:e.active_room})},JoinedRoom:function(e,t){return a(a({},e),{active_room:t.payload.room_id})},SetID:function(e,t){return a(a({},e),{user_id:t.payload.user_id})}},extraReducers:function(e){e.addCase(p.p2pConnected,(function(e,t){return a(a({},e),{p2p_connection_state:u.Connected})})),e.addCase(p.p2pConnect,(function(e,t){return a(a({},e),{p2p_connection_state:u.Connecting})})),e.addCase(p.p2pDisconnect,(function(e,t){return a(a({},e),{p2p_connection_state:u.NotConnected})}))}}),h=i([f.default,p.default],d.getDefaultMiddleware());t.AllRooms=(o=_.actions).AllRooms,t.CreatedRoom=o.CreatedRoom,t.RemovedRoom=o.RemovedRoom,t.JoinedRoom=o.JoinedRoom,t.SetID=o.SetID,t.default=d.configureStore({reducer:_.reducer,middleware:h})},8382:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};t.__esModule=!0;var l=c(n(7294)),i=n(7703),s=n(4720),u=n(7661);t.default=i.connect((function(e,t){return o(o({},t),{user_id:e.user_id,connection_state:e.p2p_connection_state})}),null)((function(e){var t=e.room,n=(e.user_id,e.connection_state),o=i.useDispatch(),a=l.useState(!0),r=a[0],c=a[1];switch(n){case u.ConnectionState.NotConnected:case u.ConnectionState.Connecting:return l.default.createElement("div",null,"Loading: ",t.name);case u.ConnectionState.Connected:return l.default.createElement("div",null,l.default.createElement("div",null,t.name),l.default.createElement("div",{style:{position:"relative"}},l.default.createElement("canvas",{width:512,height:512,ref:function(e){o(s.newCanvas(e))}}),r?l.default.createElement("canvas",{style:{position:"absolute",left:0,top:0},width:512,height:512,ref:function(e){o(s.newDebugCanvas(e))}}):l.default.createElement(l.default.Fragment,null)),l.default.createElement("div",null,l.default.createElement("label",null,l.default.createElement("input",{onChange:function(e){c(e.target.checked)},type:"checkbox",checked:r}),"Debug: ",r?"true":"false")))}}))},5019:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var a=o(n(7294)),r=n(7703),c=n(6396),l=n(3727),i=o(n(8382)),s=o(n(7661)),u=n(2933),d=n(4720),f=o(n(3912)),p=o(n(1548)),m=o(n(5125)),_=o(n(7463)),h=c.makeStyles((function(e){return{root:{}}}));t.default=r.connect((function(e){return{rooms:e.rooms,active_room:e.active_room}}),{})((function(e){var t=e.rooms,n=e.active_room,o=h(),c=(l.useHistory(),r.useDispatch()),C=function(e){s.default.dispatch(u.wsSend({JoinRoom:{room_id:e}})),c(d.p2pConnect(!1))};if(n){var E=t.find((function(e){return e.id==n}));return a.default.createElement(i.default,{room:E})}return a.default.createElement("div",{className:o.root},a.default.createElement(f.default,{variant:"contained",color:"primary",onClick:function(){c(u.wsSend({CreateRoom:{name:"Test Room "+Math.random()}})),c(d.p2pConnect(!0))}},"Create Room"),a.default.createElement(p.default,{component:"nav"},t.map((function(e,t){return a.default.createElement(m.default,{key:e.id,button:!0,onClick:C.bind(null,e.id)},a.default.createElement(_.default,{primary:e.name}))}))))}))},3628:(e,t,n)=>{"use strict";e.exports=n.p+"1fc2c97db2bdbddca248.png"},8909:(e,t,n)=>{"use strict";e.exports=n.p+"afbb487d80b277a0cf24.png"},1758:()=>{}}]);
//# sourceMappingURL=974.2e1e95caa46d053cfec6.bundle.js.map
(self.webpackChunkclient=self.webpackChunkclient||[]).push([[974],{927:(e,t,n)=>{"use strict";n.r(t);var a=n(7294),o=n(3935),r=n(3727),c=n(5977),l=n(7703),i=n(7661),s=n.n(i),u=n(5019),d=n.n(u),f=n(8382),p=n.n(f);function m(){return a.createElement(l.Provider,{store:s()},a.createElement(r.BrowserRouter,{basename:"/vvlt"},a.createElement("div",null,a.createElement("ul",null,a.createElement("li",null,a.createElement(r.Link,{to:"/"},"Home")),a.createElement("li",null,a.createElement(r.Link,{to:"/about"},"About"))),a.createElement("hr",null),a.createElement(c.rs,null,a.createElement(c.AW,{exact:!0,path:"/"},a.createElement(d(),null)),a.createElement(c.AW,{path:"/about"},a.createElement(_,null)),a.createElement(c.AW,{path:"/game"},a.createElement(p(),null))))))}function _(){return a.createElement("div",null,"Whatch'you wanna know about?")}var h=n(2933);const C=document.createElement("div");var E;document.body.appendChild(C),E=C,o.render(a.createElement(m,null),E),s().dispatch((0,h.wsConnect)({host:"wss://salty-mesa-40253.herokuapp.com/connect"}))},1920:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g,newCanvas:()=>S,newDebugCanvas:()=>b,p2pConnect:()=>m,p2pConnected:()=>h,p2pConnecting:()=>_,p2pDisconnect:()=>C,p2pMessage:()=>E,p2pSend:()=>v,p2pSignal:()=>y});var a=n(7407),o=n(8853),r=n.n(o),c=n(2933),l=n(89),i=n(8909),s=n(3628);const u=n.p+"2171111ac2bd2a768eecab43cc455816.lvl";let d=null;fetch(u).then((e=>e.arrayBuffer())).then((e=>d=new Uint8Array(e)));const f=new Image;f.src=i;const p=new Image;p.src=s;const m=(0,a.createAction)("P2P_CONNECT",(function(e){return{payload:e}})),_=(0,a.createAction)("P2P_CONNECTING"),h=(0,a.createAction)("P2P_CONNECTED"),C=(0,a.createAction)("P2P_DISCONNECT"),E=(0,a.createAction)("P2P_MESSAGE"),v=(0,a.createAction)("P2P_NEW_MESSAGE",(function(e){return{payload:e}})),y=(0,a.createAction)("P2P_SIGNAL",(function(e){return e})),S=(0,a.createAction)("NEW_GAME_CANVAS",(function(e){return{payload:e}})),b=(0,a.createAction)("NEW_DEBUG_CANVAS",(function(e){return{payload:e}})),g=(()=>{let e=null,t=null,n=null,a=null,o=null,i=null,s=0,u=0,m=null;return _=>E=>v=>{switch(v.type){case"P2P_CONNECT":return null!==e&&e.destroy(),e=new(r())({initiator:v.payload}),n=v.payload,e.on("signal",(e=>t=>{e.dispatch((0,c.wsSend)({Signal:{payload:JSON.stringify(t)}}))})(_)),e.on("connect",(e=>()=>{console.log("p2p","onConnect"),e.dispatch(h())})(_)),e.on("error",(e=>t=>{console.log("p2p","onError"),e.dispatch(C()),e.dispatch((0,c.wsSend)("LeaveRoom"))})(_)),e.on("data",(n=>{let a=t.handle_remote_input(n,performance.now());a&&e.send(a)})),E(v);case"P2P_DISCONNECT":return null!==e&&e.destroy(),e=null,E(v);case"P2P_NEW_MESSAGE":e.send(v.payload);break;case"P2P_SIGNAL":e.signal(JSON.parse(v.payload));break;case"NEW_DEBUG_CANVAS":const y=v.payload;if(null===y){cancelAnimationFrame(m);break}const S=y.getContext("2d"),b=3,g=16,w=e=>{let n=0;S.clearRect(0,0,y.width,y.height),S.font=`${g}px serif`,S.fillText(`Latency (ms): ${t.latency_ms()}`,b,n+=g),S.fillText(`Local Frame: ${s}`,b,n+=g),S.fillText(`Remote Frame: ${t.estimated_remote_frame()}`,b,n+=g),S.fillText(`Synced Frame: ${t.last_synchronized()}`,b,n+=g),S.fillText(`Hashes Sent: ${u}`,b,n+=g),m=requestAnimationFrame(w)};m=requestAnimationFrame(w);break;case"NEW_GAME_CANVAS":if(a)break;if(a=v.payload,null===a){cancelAnimationFrame(o),clearInterval(i);break}t=new l.jaY(n,d);const A=new l.cQI(a,f,p),N=new l.Thl(A,t);document.addEventListener("keydown",(n=>{let a=null;switch(n.key){case"ArrowUp":a=t.handle_up_pressed();break;case"ArrowDown":a=t.handle_down_pressed();break;case"ArrowLeft":a=t.handle_left_pressed();break;case"ArrowRight":a=t.handle_right_pressed();break;case" ":a=t.handle_fire_pressed()}a&&(n.preventDefault(),e.send(a))})),document.addEventListener("keyup",(n=>{let a=null;switch(n.key){case"ArrowUp":a=t.handle_up_released();break;case"ArrowDown":a=t.handle_down_released();break;case"ArrowLeft":a=t.handle_left_released();break;case"ArrowRight":a=t.handle_right_released();break;case" ":a=t.handle_fire_released()}a&&(n.preventDefault(),e.send(a))}));const k=e=>{N.render(t),o=requestAnimationFrame(k)};o=requestAnimationFrame(k);const O=16;i=setInterval((()=>{const n=t.needs_hash();n&&(u+=1,e.send(n));const a=t.needs_ping(performance.now());a&&e.send(a),t.estimated_remote_frame()+2*Math.max(t.latency_ms(),10*O)/O>=s&&(s=t.step())}),O);break;default:return E(v)}}})()},2933:(e,t,n)=>{"use strict";n.r(t),n.d(t,{wsConnect:()=>c,wsConnecting:()=>l,wsConnected:()=>i,wsDisconnect:()=>s,wsMessage:()=>u,wsSend:()=>d,default:()=>f});var a=n(7407),o=n(7661),r=n(1920);const c=(0,a.createAction)("WS_CONNECT"),l=(0,a.createAction)("WS_CONNECTING"),i=(0,a.createAction)("WS_CONNECTED"),s=(0,a.createAction)("WS_DISCONNECT"),u=(0,a.createAction)("WS_MESSAGE"),d=(0,a.createAction)("WS_NEW_MESSAGE",(function(e){return{payload:e}})),f=(()=>{let e=null;return t=>n=>a=>{switch(a.type){case"WS_CONNECT":null!==e&&e.close(),e=new WebSocket(a.payload.host),e.onmessage=(e=>t=>{const n=JSON.parse(t.data);"function"==typeof o[n.type]?e.dispatch(o[n.type](n.content)):"Signal"==n.type?e.dispatch((0,r.p2pSignal)(n.content)):console.error("unrecognized response!")})(t),e.onclose=(e=>()=>{e.dispatch(s())})(t),e.onopen=(e=>t=>{e.dispatch(i(t.target.url))})(t);break;case"WS_DISCONNECT":null!==e&&e.close(),e=null;break;case"WS_NEW_MESSAGE":e.send(JSON.stringify(a.payload));break;default:return n(a)}}})()},7661:function(e,t,n){"use strict";var a,o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return c(t,e),t},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],c=0,l=r.length;c<l;c++,o++)a[o]=r[c];return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.SetID=t.JoinedRoom=t.RemovedRoom=t.CreatedRoom=t.AllRooms=t.ConnectionState=void 0;var u,d=n(7407),f=s(n(2933)),p=l(n(1920));!function(e){e[e.NotConnected=0]="NotConnected",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(u=t.ConnectionState||(t.ConnectionState={}));var m={user_id:null,rooms:[],active_room:null,p2p_connection_state:u.NotConnected},_=d.createSlice({name:"root",initialState:m,reducers:{AllRooms:function(e,t){return Object.assign({},e,{rooms:t.payload.rooms})},CreatedRoom:function(e,t){return o(o({},e),{rooms:e.rooms.concat(t.payload.room)})},RemovedRoom:function(e,t){return o(o({},e),{rooms:e.rooms.filter((function(e){return e.id!==t.payload.room_id})),active_room:e.active_room==t.payload.room_id?null:e.active_room})},JoinedRoom:function(e,t){return o(o({},e),{active_room:t.payload.room_id})},SetID:function(e,t){return o(o({},e),{user_id:t.payload.user_id})}},extraReducers:function(e){e.addCase(p.p2pConnected,(function(e,t){return o(o({},e),{p2p_connection_state:u.Connected})})),e.addCase(p.p2pConnect,(function(e,t){return o(o({},e),{p2p_connection_state:u.Connecting})})),e.addCase(p.p2pDisconnect,(function(e,t){return o(o({},e),{p2p_connection_state:u.NotConnected})}))}}),h=i([f.default,p.default],d.getDefaultMiddleware());t.AllRooms=(a=_.actions).AllRooms,t.CreatedRoom=a.CreatedRoom,t.RemovedRoom=a.RemovedRoom,t.JoinedRoom=a.JoinedRoom,t.SetID=a.SetID,t.default=d.configureStore({reducer:_.reducer,middleware:h})},8382:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0;var l=c(n(7294)),i=n(7703),s=n(1920),u=n(7661);t.default=i.connect((function(e,t){return a(a({},t),{user_id:e.user_id,connection_state:e.p2p_connection_state})}),null)((function(e){var t=e.room,n=(e.user_id,e.connection_state),a=i.useDispatch(),o=l.useState(!1),r=o[0],c=o[1],d={position:"absolute",left:0,top:0,right:0,bottom:0,width:"100%"};switch(n){case u.ConnectionState.NotConnected:case u.ConnectionState.Connecting:return l.default.createElement("div",null,"Loading: ",t.name);case u.ConnectionState.Connected:return l.default.createElement("div",null,l.default.createElement("div",null,t.name),l.default.createElement("div",{style:{position:"relative"}},l.default.createElement("canvas",{style:d,width:1920,height:1080,ref:function(e){a(s.newCanvas(e))}}),r?l.default.createElement("canvas",{style:d,width:1920,height:1080,ref:function(e){a(s.newDebugCanvas(e))}}):l.default.createElement(l.default.Fragment,null)),l.default.createElement("div",null,l.default.createElement("label",null,l.default.createElement("input",{onChange:function(e){c(e.target.checked)},type:"checkbox",checked:r}),"Debug: ",r?"true":"false")))}}))},5019:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var o=a(n(7294)),r=n(7703),c=n(6396),l=n(3727),i=a(n(8382)),s=a(n(7661)),u=n(2933),d=n(1920),f=a(n(3912)),p=a(n(1548)),m=a(n(5125)),_=a(n(7463)),h=c.makeStyles((function(e){return{root:{}}}));t.default=r.connect((function(e){return{rooms:e.rooms,active_room:e.active_room}}),{})((function(e){var t=e.rooms,n=e.active_room,a=h(),c=(l.useHistory(),r.useDispatch()),C=function(e){s.default.dispatch(u.wsSend({JoinRoom:{room_id:e}})),c(d.p2pConnect(!1))};if(n){var E=t.find((function(e){return e.id==n}));return o.default.createElement(i.default,{room:E})}return o.default.createElement("div",{className:a.root},o.default.createElement(f.default,{variant:"contained",color:"primary",onClick:function(){c(u.wsSend({CreateRoom:{name:"Test Room "+Math.random()}})),c(d.p2pConnect(!0))}},"Create Room"),o.default.createElement(p.default,{component:"nav"},t.map((function(e,t){return o.default.createElement(m.default,{key:e.id,button:!0,onClick:C.bind(null,e.id)},o.default.createElement(_.default,{primary:e.name}))}))))}))},3628:(e,t,n)=>{"use strict";e.exports=n.p+"1fc2c97db2bdbddca248.png"},8909:(e,t,n)=>{"use strict";e.exports=n.p+"afbb487d80b277a0cf24.png"},1758:()=>{}}]);
//# sourceMappingURL=974.dd344cc3e91f635e71bf.bundle.js.map